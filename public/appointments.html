<!DOCTYPE html>
<html>
<head>
  <title>Appointments</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
>
</head>

<body>

  <div id="header"></div>

   <!-- MAIN CONTENT -->
   <div class="col-md-10 p-4 main-content">
<h3>ðŸ“… Appointments</h3>

<div class="card p-3 mb-4">
  <div class="row g-2">
    <div class="col-md-4">
      <select id="patient" class="form-select"></select>
    </div>
    <div class="col-md-4">
      <select id="doctor" class="form-select"></select>
    </div>
    <div class="col-md-4">
      <input type="date" id="date" class="form-control" min="">
    </div>
    <div class="col-md-4">
      <input type="time" id="time" class="form-control">
    </div>
    
  </div>

  <button class="btn btn-primary mt-3" onclick="addAppointment()">
    Add Appointment
  </button>
</div>

<div class="row" id="appointments"></div>

</div>
</div>
</div>
<script>
async function loadDropdowns() {
  const patientsRes = await fetch('/api/mobile/patients');
const doctorsRes = await fetch('/api/mobile/doctors');

const patientsData = await patientsRes.json();
const doctorsData = await doctorsRes.json();

const patients = patientsData.patients;
const doctors = doctorsData.doctors;


  document.getElementById('patient').innerHTML =
    patients.map(p => `<option value="${p.id}">${p.name}</option>`).join('');

  document.getElementById('doctor').innerHTML =
    doctors.map(d => `<option value="${d.id}">${d.name}</option>`).join('');
}

async function addAppointment() {
  const patient_id = document.getElementById('patient').value;
  const doctor_id = document.getElementById('doctor').value;
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;

  if (!time) {
    return alert('Pick time');
  }

  if (!date) return alert('Pick a date');

  const selectedDate = new Date(date);
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  if (selectedDate < today) {
    return alert('Appointment date must be today or in the future');
  }

  await fetch('/api/mobile/appointments', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ patient_id, doctor_id, date, time })
  });

  loadAppointments();
}

async function loadAppointments() {
  const res = await fetch('/api/mobile/appointments');
const json = await res.json();
const data = json.appointments;


  const box = document.getElementById('appointments');
  box.innerHTML = '';

  const today = new Date();
  today.setHours(0, 0, 0, 0);

  data
    .filter(a => new Date(a.date) >= today)
    .forEach(a => {
      box.innerHTML += `
        <div class="col-md-4 mb-3">
          <div class="card p-3 shadow-sm">
            <h6>${a.patient}</h6>
            <p class="mb-1">Doctor: ${a.doctor}</p>
            <p class="mb-0">Date: ${a.date} at ${a.time}</p>
          </div>
        </div>
      `;
    });
}


loadDropdowns();
loadAppointments();
</script>

<script>
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('date').setAttribute('min', today);
  </script>

<script>
  fetch("header.html")
    .then(res => res.text())
    .then(html => document.getElementById("header").innerHTML = html);
</script>  


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>
